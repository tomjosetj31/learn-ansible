# Day 7: Jinja2 Templates & Common Modules

## Jinja2 Templating

Jinja2 is the templating engine used by Ansible. It allows you to create dynamic configuration files, scripts, and content by embedding variables, logic, and filters into templates.

---

## Template Basics

### What is a Template?

A template is a text file with placeholders that get replaced with actual values at runtime. In Ansible, templates typically have the `.j2` extension.

### Using the template Module

```yaml
tasks:
  - name: Deploy configuration from template
    ansible.builtin.template:
      src: nginx.conf.j2
      dest: /etc/nginx/nginx.conf
      owner: root
      group: root
      mode: '0644'
    notify: Restart nginx
```

### Template File Structure

**templates/nginx.conf.j2:**
```jinja2
# Nginx Configuration
# Generated by Ansible on {{ ansible_date_time.iso8601 }}
# Managed by Ansible - DO NOT EDIT MANUALLY

user {{ nginx_user }};
worker_processes {{ nginx_workers | default('auto') }};
pid /run/nginx.pid;

events {
    worker_connections {{ nginx_connections | default(1024) }};
}

http {
    server {
        listen {{ nginx_port }};
        server_name {{ nginx_server_name }};
        root {{ nginx_document_root }};
    }
}
```

---

## Variables in Templates

### Basic Variable Substitution

```jinja2
# Simple variable
Hello, {{ username }}!

# Dictionary access
Database host: {{ database.host }}
Database port: {{ database.port }}

# List access
First server: {{ servers[0] }}

# Ansible facts
Hostname: {{ ansible_hostname }}
IP Address: {{ ansible_default_ipv4.address }}
OS: {{ ansible_distribution }} {{ ansible_distribution_version }}
Memory: {{ ansible_memtotal_mb }} MB
```

### Variable with Default Values

```jinja2
# If variable is undefined, use default
Port: {{ app_port | default(8080) }}
User: {{ app_user | default('www-data') }}
Debug: {{ debug_mode | default(false) }}

# Default to another variable
Log path: {{ custom_log_path | default(default_log_path) }}

# Omit if undefined (useful in configs)
{% if optional_setting is defined %}
setting = {{ optional_setting }}
{% endif %}
```

---

## Control Structures

### Conditionals (if/elif/else)

```jinja2
{% if environment == 'production' %}
DEBUG = false
LOG_LEVEL = warn
{% elif environment == 'staging' %}
DEBUG = true
LOG_LEVEL = info
{% else %}
DEBUG = true
LOG_LEVEL = debug
{% endif %}
```

### Conditional Expressions (Ternary)

```jinja2
# Inline conditional
debug = {{ 'true' if debug_mode else 'false' }}

# With variables
max_connections = {{ 1000 if environment == 'production' else 100 }}
```

### Checking Variable State

```jinja2
{% if database_password is defined %}
DB_PASSWORD={{ database_password }}
{% endif %}

{% if users is not defined or users | length == 0 %}
# No users configured
{% endif %}

{% if feature_enabled is defined and feature_enabled %}
FEATURE_X=enabled
{% endif %}
```

### Loops (for)

```jinja2
# Simple loop
{% for package in packages %}
- {{ package }}
{% endfor %}

# Loop with index
{% for user in users %}
{{ loop.index }}. {{ user.name }} ({{ user.email }})
{% endfor %}

# Loop with conditions
{% for server in servers if server.enabled %}
server {{ server.name }} {{ server.ip }}:{{ server.port }};
{% endfor %}

# Dictionary loop
{% for key, value in settings.items() %}
{{ key }} = {{ value }}
{% endfor %}
```

### Loop Variables

| Variable | Description |
|----------|-------------|
| `loop.index` | Current iteration (1-indexed) |
| `loop.index0` | Current iteration (0-indexed) |
| `loop.first` | True if first iteration |
| `loop.last` | True if last iteration |
| `loop.length` | Total number of items |
| `loop.revindex` | Iterations until end (1-indexed) |

```jinja2
{% for host in groups['webservers'] %}
{{ host }}{% if not loop.last %},{% endif %}
{% endfor %}

# Result: web1,web2,web3
```

---

## Filters

Filters transform values. Use the pipe `|` symbol.

### String Filters

```jinja2
# Case conversion
{{ name | upper }}              # HELLO
{{ name | lower }}              # hello
{{ name | capitalize }}         # Hello
{{ name | title }}              # Hello World

# Whitespace
{{ text | trim }}               # Remove leading/trailing whitespace
{{ text | indent(4) }}          # Add 4-space indent

# Replace
{{ path | replace('/', '-') }}

# Regex
{{ text | regex_replace('old', 'new') }}
{{ text | regex_search('pattern') }}

# String manipulation
{{ hostname | split('.') | first }}    # Get first part of FQDN
{{ items | join(', ') }}               # Join list to string
```

### Numeric Filters

```jinja2
# Math operations
{{ disk_space | int }}              # Convert to integer
{{ percentage | float }}            # Convert to float
{{ value | abs }}                   # Absolute value
{{ numbers | sum }}                 # Sum of list
{{ numbers | max }}                 # Maximum value
{{ numbers | min }}                 # Minimum value

# Rounding
{{ 3.7 | round }}                   # 4.0
{{ 3.7 | int }}                     # 3

# Formatting
{{ large_number | human_readable }}  # 1.5 GB
{{ bytes | filesizeformat }}         # 1.2 MB
```

### List Filters

```jinja2
# List operations
{{ users | length }}                 # Count items
{{ users | first }}                  # First item
{{ users | last }}                   # Last item
{{ numbers | sort }}                 # Sort ascending
{{ numbers | sort(reverse=true) }}   # Sort descending
{{ items | unique }}                 # Remove duplicates
{{ items | shuffle }}                # Randomize order
{{ items | flatten }}                # Flatten nested lists

# Filtering
{{ users | selectattr('active', 'true') | list }}
{{ servers | rejectattr('disabled') | list }}
{{ numbers | select('gt', 5) | list }}

# Mapping
{{ users | map(attribute='name') | list }}

# Random selection
{{ groups['webservers'] | random }}
```

### Dictionary Filters

```jinja2
# Dictionary operations
{{ my_dict | dict2items }}           # Convert to list of {key, value}
{{ my_list | items2dict }}           # Convert list to dict
{{ dict1 | combine(dict2) }}         # Merge dictionaries

# Get keys/values
{{ my_dict.keys() | list }}
{{ my_dict.values() | list }}
```

### Type Conversion Filters

```jinja2
{{ "42" | int }}                     # String to integer
{{ 42 | string }}                    # Integer to string
{{ "3.14" | float }}                 # String to float
{{ "yes" | bool }}                   # String to boolean
{{ my_dict | to_json }}              # To JSON string
{{ my_dict | to_yaml }}              # To YAML string
{{ my_dict | to_nice_json }}         # Pretty JSON
{{ my_dict | to_nice_yaml }}         # Pretty YAML
```

### Path Filters

```jinja2
{{ "/path/to/file.txt" | basename }}      # file.txt
{{ "/path/to/file.txt" | dirname }}       # /path/to
{{ "file.txt" | splitext }}               # ['file', '.txt']
{{ path | expanduser }}                   # Expand ~
{{ path | realpath }}                     # Resolve symlinks
```

### Default and Mandatory

```jinja2
# Default value if undefined
{{ optional_var | default('fallback') }}

# Default if empty or undefined
{{ maybe_empty | default('fallback', true) }}

# Fail if undefined
{{ required_var | mandatory }}
```

### Hash and Encoding Filters

```jinja2
{{ password | password_hash('sha512') }}
{{ data | b64encode }}
{{ encoded | b64decode }}
{{ text | hash('md5') }}
{{ text | hash('sha256') }}
```

---

## Comments

```jinja2
{# This is a comment - won't appear in output #}

{# 
   Multi-line comment
   Also won't appear in output
#}

# This is NOT a Jinja2 comment - will appear in output
```

---

## Whitespace Control

Control whitespace with `-` in tags:

```jinja2
# Normal (preserves whitespace)
{% for item in items %}
{{ item }}
{% endfor %}

# Strip whitespace
{%- for item in items -%}
{{ item }}
{%- endfor -%}
```

---

## Template Examples

### Example 1: Apache Virtual Host

**templates/vhost.conf.j2:**
```jinja2
# Virtual Host Configuration for {{ domain }}
# Generated by Ansible

<VirtualHost *:{{ http_port | default(80) }}>
    ServerName {{ domain }}
    {% if server_aliases is defined %}
    {% for alias in server_aliases %}
    ServerAlias {{ alias }}
    {% endfor %}
    {% endif %}
    
    DocumentRoot {{ document_root }}
    
    <Directory {{ document_root }}>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>
    
    ErrorLog ${APACHE_LOG_DIR}/{{ domain }}-error.log
    CustomLog ${APACHE_LOG_DIR}/{{ domain }}-access.log combined
    
    {% if ssl_enabled | default(false) %}
    SSLEngine on
    SSLCertificateFile {{ ssl_certificate }}
    SSLCertificateKeyFile {{ ssl_certificate_key }}
    {% endif %}
</VirtualHost>
```

### Example 2: Application Configuration

**templates/app-config.yml.j2:**
```jinja2
---
# Application Configuration
# Environment: {{ environment }}
# Generated: {{ ansible_date_time.iso8601 }}

application:
  name: {{ app_name }}
  version: {{ app_version }}
  environment: {{ environment }}
  debug: {{ debug_mode | default(false) | lower }}

server:
  host: {{ app_host | default('0.0.0.0') }}
  port: {{ app_port | default(8080) }}
  workers: {{ app_workers | default(ansible_processor_vcpus) }}

database:
  host: {{ database.host }}
  port: {{ database.port | default(5432) }}
  name: {{ database.name }}
  user: {{ database.user }}
  password: {{ database.password }}
  pool_size: {{ database.pool_size | default(10) }}

{% if redis is defined %}
redis:
  host: {{ redis.host }}
  port: {{ redis.port | default(6379) }}
  {% if redis.password is defined %}
  password: {{ redis.password }}
  {% endif %}
{% endif %}

logging:
  level: {{ log_level | default('INFO') }}
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
  {% if log_file is defined %}
  file: {{ log_file }}
  {% endif %}

features:
{% for feature in features | default([]) %}
  {{ feature.name }}: {{ feature.enabled | lower }}
{% endfor %}
```

### Example 3: /etc/hosts File

**templates/hosts.j2:**
```jinja2
# /etc/hosts - Managed by Ansible
127.0.0.1   localhost
::1         localhost ip6-localhost ip6-loopback

# Cluster nodes
{% for host in groups['all'] %}
{{ hostvars[host]['ansible_default_ipv4']['address'] }}   {{ host }} {{ hostvars[host]['ansible_hostname'] }}
{% endfor %}

# Custom entries
{% for entry in custom_hosts | default([]) %}
{{ entry.ip }}   {{ entry.hostname }}{% if entry.aliases is defined %} {{ entry.aliases | join(' ') }}{% endif %}

{% endfor %}
```

### Example 4: Systemd Service Unit

**templates/myapp.service.j2:**
```jinja2
# {{ app_name }} Service
# Managed by Ansible

[Unit]
Description={{ app_description | default(app_name + ' Service') }}
After=network.target
{% if requires is defined %}
{% for req in requires %}
Requires={{ req }}
{% endfor %}
{% endif %}

[Service]
Type={{ service_type | default('simple') }}
User={{ app_user }}
Group={{ app_group | default(app_user) }}
WorkingDirectory={{ app_directory }}
ExecStart={{ app_directory }}/bin/{{ app_name }} {{ app_args | default('') }}
{% if exec_stop is defined %}
ExecStop={{ exec_stop }}
{% endif %}
Restart={{ restart_policy | default('on-failure') }}
RestartSec={{ restart_sec | default(5) }}

# Environment
{% for key, value in app_environment.items() %}
Environment="{{ key }}={{ value }}"
{% endfor %}

# Limits
{% if limit_nofile is defined %}
LimitNOFILE={{ limit_nofile }}
{% endif %}

[Install]
WantedBy=multi-user.target
```

---

## Macros

Macros are reusable template functions:

```jinja2
{% macro render_server(name, ip, port) %}
server {
    name = {{ name }}
    address = {{ ip }}:{{ port }}
}
{% endmacro %}

# Usage
{% for server in servers %}
{{ render_server(server.name, server.ip, server.port) }}
{% endfor %}
```

---

## Including Other Templates

```jinja2
{% include 'header.j2' %}

# Main content here

{% include 'footer.j2' %}
```

With optional ignore missing:
```jinja2
{% include 'optional-section.j2' ignore missing %}
```

---

# Common Ansible Modules

This section covers the most frequently used Ansible modules for beginners.

---

## File Modules

### file - Manage Files and Directories

```yaml
tasks:
  # Create a directory
  - name: Create application directory
    ansible.builtin.file:
      path: /opt/myapp
      state: directory
      owner: www-data
      group: www-data
      mode: '0755'

  # Create an empty file
  - name: Create log file
    ansible.builtin.file:
      path: /var/log/myapp.log
      state: touch
      owner: www-data
      mode: '0644'

  # Create a symbolic link
  - name: Create symlink
    ansible.builtin.file:
      src: /opt/myapp/current
      dest: /var/www/html
      state: link

  # Delete a file or directory
  - name: Remove old files
    ansible.builtin.file:
      path: /tmp/old-data
      state: absent

  # Set permissions recursively
  - name: Fix permissions
    ansible.builtin.file:
      path: /opt/myapp
      owner: www-data
      group: www-data
      recurse: yes
```

### copy - Copy Files to Remote Hosts

```yaml
tasks:
  # Copy a file
  - name: Copy configuration file
    ansible.builtin.copy:
      src: files/app.conf
      dest: /etc/myapp/app.conf
      owner: root
      group: root
      mode: '0644'
      backup: yes  # Create backup if file exists

  # Copy content directly
  - name: Create file with content
    ansible.builtin.copy:
      content: |
        # Configuration file
        setting1=value1
        setting2=value2
      dest: /etc/myapp/settings.conf
      mode: '0644'

  # Copy with validation
  - name: Copy nginx config
    ansible.builtin.copy:
      src: nginx.conf
      dest: /etc/nginx/nginx.conf
      validate: nginx -t -c %s
```

### template - Deploy Jinja2 Templates

```yaml
tasks:
  - name: Deploy application config
    ansible.builtin.template:
      src: templates/app.conf.j2
      dest: /etc/myapp/app.conf
      owner: www-data
      mode: '0640'
      validate: /opt/myapp/bin/validate-config %s
    notify: Restart application
```

### lineinfile - Manage Lines in Files

```yaml
tasks:
  # Ensure a line exists
  - name: Enable IP forwarding
    ansible.builtin.lineinfile:
      path: /etc/sysctl.conf
      regexp: '^net.ipv4.ip_forward'
      line: 'net.ipv4.ip_forward = 1'
      state: present

  # Add line after a pattern
  - name: Add config after header
    ansible.builtin.lineinfile:
      path: /etc/myapp.conf
      insertafter: '^\[settings\]'
      line: 'new_option = value'

  # Remove a line
  - name: Remove deprecated option
    ansible.builtin.lineinfile:
      path: /etc/myapp.conf
      regexp: '^deprecated_option'
      state: absent
```

### blockinfile - Manage Blocks of Text

```yaml
tasks:
  - name: Add SSH banner
    ansible.builtin.blockinfile:
      path: /etc/ssh/sshd_config
      block: |
        # Custom settings
        Banner /etc/issue.net
        MaxAuthTries 3
        PermitRootLogin no
      marker: "# {mark} ANSIBLE MANAGED BLOCK"
```

---

## Package Modules

### apt - Manage Debian/Ubuntu Packages

```yaml
tasks:
  # Install a package
  - name: Install nginx
    ansible.builtin.apt:
      name: nginx
      state: present
      update_cache: yes

  # Install multiple packages
  - name: Install required packages
    ansible.builtin.apt:
      name:
        - nginx
        - postgresql
        - python3-pip
      state: present

  # Install specific version
  - name: Install specific nginx version
    ansible.builtin.apt:
      name: nginx=1.18.0-0ubuntu1
      state: present

  # Remove a package
  - name: Remove apache
    ansible.builtin.apt:
      name: apache2
      state: absent
      purge: yes  # Remove config files too

  # Upgrade all packages
  - name: Upgrade all packages
    ansible.builtin.apt:
      upgrade: dist
      update_cache: yes
```

### yum/dnf - Manage RHEL/CentOS Packages

```yaml
tasks:
  # Install package (yum for older RHEL)
  - name: Install httpd
    ansible.builtin.yum:
      name: httpd
      state: present

  # Install with dnf (RHEL 8+)
  - name: Install packages
    ansible.builtin.dnf:
      name:
        - nginx
        - postgresql-server
      state: present

  # Install from URL
  - name: Install package from URL
    ansible.builtin.dnf:
      name: https://example.com/package.rpm
      state: present
```

### package - Generic Package Module

```yaml
tasks:
  # Works across different package managers
  - name: Install git
    ansible.builtin.package:
      name: git
      state: present
```

### pip - Manage Python Packages

```yaml
tasks:
  # Install pip package
  - name: Install Flask
    ansible.builtin.pip:
      name: flask
      state: present

  # Install from requirements file
  - name: Install requirements
    ansible.builtin.pip:
      requirements: /opt/myapp/requirements.txt
      virtualenv: /opt/myapp/venv

  # Install specific version
  - name: Install specific version
    ansible.builtin.pip:
      name: django==4.2
      state: present
```

---

## Service Modules

### service - Manage Services

```yaml
tasks:
  # Start and enable a service
  - name: Start nginx
    ansible.builtin.service:
      name: nginx
      state: started
      enabled: yes

  # Restart a service
  - name: Restart nginx
    ansible.builtin.service:
      name: nginx
      state: restarted

  # Reload configuration
  - name: Reload nginx
    ansible.builtin.service:
      name: nginx
      state: reloaded

  # Stop and disable
  - name: Stop apache
    ansible.builtin.service:
      name: apache2
      state: stopped
      enabled: no
```

### systemd - Manage systemd Services

```yaml
tasks:
  # Reload systemd daemon
  - name: Reload systemd
    ansible.builtin.systemd:
      daemon_reload: yes

  # Start service with systemd
  - name: Start myapp
    ansible.builtin.systemd:
      name: myapp
      state: started
      enabled: yes
      scope: system  # or 'user'
```

---

## User and Group Modules

### user - Manage User Accounts

```yaml
tasks:
  # Create a user
  - name: Create deploy user
    ansible.builtin.user:
      name: deploy
      comment: "Deployment User"
      uid: 1100
      groups: sudo,docker
      shell: /bin/bash
      create_home: yes
      state: present

  # Create user with SSH key
  - name: Create user with key
    ansible.builtin.user:
      name: ansible
      generate_ssh_key: yes
      ssh_key_bits: 4096

  # Remove a user
  - name: Remove old user
    ansible.builtin.user:
      name: olduser
      state: absent
      remove: yes  # Remove home directory
```

### group - Manage Groups

```yaml
tasks:
  # Create a group
  - name: Create developers group
    ansible.builtin.group:
      name: developers
      gid: 2000
      state: present
```

### authorized_key - Manage SSH Keys

```yaml
tasks:
  # Add SSH key
  - name: Add SSH key for user
    ansible.builtin.authorized_key:
      user: deploy
      key: "{{ lookup('file', '~/.ssh/id_rsa.pub') }}"
      state: present

  # Add key from URL
  - name: Add GitHub key
    ansible.builtin.authorized_key:
      user: deploy
      key: https://github.com/username.keys
      state: present
```

---

## Command Modules

### command - Run Commands

```yaml
tasks:
  # Run a simple command
  - name: Check disk space
    ansible.builtin.command: df -h
    register: disk_space
    changed_when: false

  # Run with arguments
  - name: Run script
    ansible.builtin.command:
      cmd: /opt/scripts/setup.sh --env production
      chdir: /opt/myapp
      creates: /opt/myapp/.initialized  # Skip if file exists
```

### shell - Run Shell Commands

```yaml
tasks:
  # Shell allows pipes and redirects
  - name: Find large files
    ansible.builtin.shell: find /var/log -size +100M | head -10
    register: large_files

  # Multi-line script
  - name: Complex shell operation
    ansible.builtin.shell: |
      cd /opt/myapp
      source venv/bin/activate
      python manage.py migrate
      python manage.py collectstatic --noinput
```

### script - Run Local Scripts Remotely

```yaml
tasks:
  # Copy and execute local script
  - name: Run setup script
    ansible.builtin.script: scripts/setup.sh
    args:
      creates: /opt/myapp/.setup-complete
```

### raw - Run Raw SSH Commands

```yaml
tasks:
  # Use for hosts without Python
  - name: Install Python
    ansible.builtin.raw: apt-get install -y python3
    become: yes
```

---

## System Modules

### cron - Manage Cron Jobs

```yaml
tasks:
  # Create a cron job
  - name: Schedule backup
    ansible.builtin.cron:
      name: "Daily backup"
      minute: "0"
      hour: "2"
      job: "/opt/scripts/backup.sh >> /var/log/backup.log 2>&1"
      user: root

  # Remove a cron job
  - name: Remove old cron
    ansible.builtin.cron:
      name: "Old task"
      state: absent
```

### hostname - Set Hostname

```yaml
tasks:
  - name: Set hostname
    ansible.builtin.hostname:
      name: webserver01
```

### reboot - Reboot the System

```yaml
tasks:
  - name: Reboot server
    ansible.builtin.reboot:
      reboot_timeout: 600
      msg: "Rebooting for kernel update"
```

### sysctl - Manage Kernel Parameters

```yaml
tasks:
  - name: Enable IP forwarding
    ansible.posix.sysctl:
      name: net.ipv4.ip_forward
      value: '1'
      sysctl_set: yes
      state: present
      reload: yes
```

---

## Network Modules

### uri - Interact with HTTP APIs

```yaml
tasks:
  # GET request
  - name: Check API health
    ansible.builtin.uri:
      url: http://localhost:8080/health
      method: GET
      status_code: 200
    register: health_check

  # POST request
  - name: Create resource via API
    ansible.builtin.uri:
      url: https://api.example.com/users
      method: POST
      body:
        name: "John Doe"
        email: "john@example.com"
      body_format: json
      headers:
        Authorization: "Bearer {{ api_token }}"
      status_code: [200, 201]
```

### get_url - Download Files

```yaml
tasks:
  - name: Download application
    ansible.builtin.get_url:
      url: https://releases.example.com/app-1.0.tar.gz
      dest: /tmp/app-1.0.tar.gz
      checksum: sha256:abc123...
      mode: '0644'
```

### wait_for - Wait for Conditions

```yaml
tasks:
  # Wait for port
  - name: Wait for app to start
    ansible.builtin.wait_for:
      port: 8080
      host: localhost
      delay: 5
      timeout: 300

  # Wait for file
  - name: Wait for lock file removal
    ansible.builtin.wait_for:
      path: /var/run/myapp.lock
      state: absent
      timeout: 120
```

---

## Archive Modules

### archive - Create Archives

```yaml
tasks:
  - name: Create backup archive
    ansible.builtin.archive:
      path:
        - /opt/myapp/data
        - /opt/myapp/config
      dest: /backups/myapp-backup.tar.gz
      format: gz
```

### unarchive - Extract Archives

```yaml
tasks:
  # Extract from control node
  - name: Deploy application
    ansible.builtin.unarchive:
      src: files/app-1.0.tar.gz
      dest: /opt/myapp/

  # Extract from remote URL
  - name: Extract from URL
    ansible.builtin.unarchive:
      src: https://example.com/app.tar.gz
      dest: /opt/myapp/
      remote_src: yes
```

---

## Debug and Information

### debug - Print Debug Messages

```yaml
tasks:
  - name: Show variable value
    ansible.builtin.debug:
      var: my_variable

  - name: Show message
    ansible.builtin.debug:
      msg: "Deploying version {{ app_version }} to {{ inventory_hostname }}"

  - name: Show verbose info
    ansible.builtin.debug:
      msg: "{{ hostvars[inventory_hostname] }}"
      verbosity: 2  # Only show with -vv or higher
```

### setup - Gather Facts

```yaml
tasks:
  # Gather all facts
  - name: Get system info
    ansible.builtin.setup:
    register: facts

  # Gather specific facts
  - name: Get network facts only
    ansible.builtin.setup:
      gather_subset:
        - network
```

### assert - Validate Conditions

```yaml
tasks:
  - name: Validate requirements
    ansible.builtin.assert:
      that:
        - ansible_memtotal_mb >= 2048
        - ansible_processor_vcpus >= 2
      fail_msg: "System does not meet minimum requirements"
      success_msg: "System requirements validated"
```

---

## Module Quick Reference

| Module | Purpose | Common Parameters |
|--------|---------|-------------------|
| `file` | Manage files/directories | `path`, `state`, `owner`, `mode` |
| `copy` | Copy files | `src`, `dest`, `content`, `mode` |
| `template` | Deploy templates | `src`, `dest`, `validate` |
| `lineinfile` | Manage lines | `path`, `regexp`, `line`, `state` |
| `apt` | Debian packages | `name`, `state`, `update_cache` |
| `yum/dnf` | RHEL packages | `name`, `state` |
| `pip` | Python packages | `name`, `requirements`, `virtualenv` |
| `service` | Manage services | `name`, `state`, `enabled` |
| `user` | Manage users | `name`, `groups`, `shell`, `state` |
| `group` | Manage groups | `name`, `gid`, `state` |
| `command` | Run commands | `cmd`, `chdir`, `creates` |
| `shell` | Run shell commands | Allows pipes/redirects |
| `cron` | Manage cron | `name`, `minute`, `hour`, `job` |
| `uri` | HTTP requests | `url`, `method`, `body` |
| `debug` | Print info | `msg`, `var` |
| `wait_for` | Wait for conditions | `port`, `path`, `timeout` |

---

## Summary

Jinja2 templates and common modules are fundamental to Ansible automation:

- **Templates** enable dynamic configuration with variables, conditionals, loops, and filters
- **Modules** are the building blocks that perform actual work on managed hosts
- Always use **FQCN** (e.g., `ansible.builtin.copy`) for clarity
- Check module documentation with `ansible-doc <module_name>`

```bash
# View module documentation
ansible-doc ansible.builtin.copy
ansible-doc ansible.builtin.template
ansible-doc -l | grep apt  # Search for modules
```

Master these concepts to write powerful, flexible Ansible automation!
